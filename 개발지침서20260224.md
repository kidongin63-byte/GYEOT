# 곁 (GYEOT) 프로젝트 개발 지침서 & 요약서
**작성일**: 2026년 2월 24일

---

## 1. 프로젝트 개요 (Overview)
'곁(GYEOT)'은 홀로 계신 어르신(시니어)을 타겟으로 한 **AI 스마트폰 동행 및 안전 모니터링 모바일 웹뷰(WebView) 애플리케이션**입니다.
어르신들이 거부감 없이 따뜻한 대화를 나눌 수 있는 **AI 손녀/손자 '반디'** 포지셔닝을 채택했으며, 사용자의 기기 조작 능력을 고려해 글씨를 크고 시원하게 배치한 직관적인 UI/UX가 핵심입니다.

## 2. 사용된 기술 스택 (Tech Stack)
*   **프레임워크:** Next.js 16 (React 19)
*   **스타일링:** Tailwind CSS v4, `clsx`, `tailwind-merge`
*   **UI/아이콘 컴포넌트:** Radix UI, Lucide React (`lucide-react`)
*   **음성 인식 및 합성 처리 (STT/TTS):** Web Speech API (`SpeechRecognition`, `SpeechSynthesisUtterance`)
*   **AI (대화 엔진):** Google Generative AI (Gemini 1.5 Pro/Flash)
*   **백엔드 & 데이터베이스:** Firebase 12.x (Firestore, Auth)
*   **환경 설정:** Vercel 등을 통한 호스팅 및 배포 최적화 지원

---

## 3. 핵심 아키텍처 및 구현 현황

### 3.1 모바일 최적화 및 레이아웃 (Layout & UI)
*   **단일 화면 전환(SPA) 구조:** 페이지 이동(라우팅)으로 인한 로딩 지연과 혼란을 막기 위해 탭(Tab) 기반 렌더링을 구현했습니다. (Dashboard, Chat, Memo, Report, Emergency View 전환)
*   **디자인 시스템 톤앤매너:** 보라색(`brand-purple`)을 메인 테마 색상으로 선정하고, 가독성을 위한 큰 글씨 체계와 부드러운 둥근 모서리(Pill-shaped, `rounded-[32px]~`) 패턴을 전역에 적용했습니다.
*   **스크롤 구역(ScrollArea) 독립:** 최상단 헤더(Header)나 하단 네비게이션(Navbar) 바는 고정(`fixed/shrink-0`)하고 내용(Content)만 독립적으로 스크롤되게 하여 모바일 네이티브 앱 같은 쾌적한 사용감을 줍니다.

### 3.2 반디 설정 화면 (Settings Modal Redesign)
최근 대폭 개편된 영역으로, 모바일 환경의 사용성을 가장 중시했습니다.
1.  **풀스크린 모달:** 작은 팝업이 아니라 화면 전체를 채우는 풀스크린 오버레이(`fixed inset-0 z-[100] bg-[#F8F6FC]`) 형식 도입.
2.  **나의 호칭 (사용자 이름):**
    *   중앙의 큼직한 화이트톤 카드에 사용자의 현재 호칭 노출.
    *   `localStorage`를 활용해 '대장', '할머니' 등 본인이 원하는 이름으로 언제든 변경(`prompt` 창) 및 영구 저장 유지 기능 적용.
3.  **목소리 및 글꼴 맞춤 설정:**
    *   여성/남성 각각 3가지 톤 선택 가능 (`window.speechSynthesis.getVoices()` 활용).
    *   표준체(나눔고딕), 명조체(나눔명조), 굵은체(블랙한산스) 3가지 글꼴을 지원하며 누르는 즉시 앱 전체 글꼴이 변경되게 동적 클래스 세팅(`cn()`).
    *   활성화된 버튼만 보라색 테두리와 꽉 채워진 색상을 가지게 하여 직관성(Visibility) 강화.

### 3.3 대화 인터페이스 (Chat UI & AI Logic)
어르신과 '반디'가 실제로 소통하는 핵심 구역입니다.
1.  **여백 및 프로필 최적화:** AI의 아바타 아이콘과 유저 말풍선의 여백, 그리고 입력 바인 하단 텍스트 입력창 사이의 위아래 여백을 넓혀 터치 오류를 방지했습니다.
2.  **Gemini AI 연동:** `/api/chat` 경로에 POST 방식으로 메시지 이력을 전부 담아 전송하여 **컨텍스트(Context, 문맥)**가 유지된 답변을 얻습니다. (System Prompt로 '다정한 손녀/손자' 역할 부여)
3.  **동적 호칭 반영 로직:** 프론트엔드에서 API로 메시지를 보낼 때 현재 호칭 상태값을 헤더나 payload에 같이 감싸 보내 AI가 확실하게 **"OO 할머니, ~"** 식으로 사용자를 고정해서 부르도록 강제 제어했습니다.
4.  **대화형 음악 자동 재생 (YouTube Integration):** 어르신이 노래를 요청할 경우 AI가 자연스럽게 제안 및 동의를 구한 뒤, 긍정적인 답변 시 백엔드에서 `youtube-search-api`를 활용해 해당 곡(YouTube Video ID)을 가져와 프론트엔드의 숨겨진 오디오 플레이어(`react-youtube`)로 즉시 자동 재생합니다.


### 3.4 곁리포트 (Report) 및 긴급 구조 (Emergency/SOS) 
*   **곁리포트 (Report Tab):**
    *   정돈된 대시보드 카드 UI.
    *   활동량(블루), 약 복용(그린) 아이콘을 크게 배치.
    *   [오늘의 대화 패턴] 차트는 서드파티 라이브러리(Chart.js 등) 패키지 무게를 줄이기 위해 Tailwind와 `<svg>` 패스를 직접 순수 코딩(Pure SVG) 형태로 구현하여 물결 모양(Wave)과 그라데이션을 시각화했습니다.
*   **긴급 상황 (Emergency Tab):**
    *   직관적인 붉은색 풀스크린 애니메이션(`animate-pulse`) 적용.
    *   보호자 및 긴급 의료 기관 전화번호(`tel:`) 다이렉트 호출, 현재 위치 파악 UI.

---

## 4. 추후 과제 (Next Steps / To-Do)
1.  **Firebase 연결 고도화:** 현재 프론트 UI 로직이 완비되었으므로, `lib/firebase.ts` 로직(사용자 가입, 대화 기록 저장, 활동 알림)을 실제 회원가입 및 세션(Firestore/Auth)과 연결하여 개인화 데이터를 다듬어야 합니다.
2.  **AI 로직 프롬프트 상세 조정:** 페르소나 설정 파일과 Temperature 설정값 최적화로 '할루시네이션(거짓 답변)' 방지 및 더 높은 공감 능력 부여.
3.  **TTS (음성합성) 안정화:** 브라우저별로 지원되는 한국어 보이스 엔진이 달라, 추후 Google Cloud Text-to-Speech API 등의 상용 API로 대체 시 더 자연스럽고 감정 섞인 목소리 구현이 가능합니다.
4.  **최종 PWA 지원 강화:** 현재 패키지가 셋업되어 있으니 manifest 연동 등을 확실하게 마무리하여 유저가 스마트폰 홈화면에 [앱 설치] 버튼으로 네이티브 앱처럼 설치해 쓸 수 있도록 합니다.
